<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Viewer - Modern Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <div class="header">
            <h1><i class="fas fa-shopping-cart"></i> Order Viewer</h1>
            <p>Search and explore customer orders with ease</p>
        </div>

        <!-- Search Section -->
        <div class="search-section">
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input 
                    type="text" 
                    id="search" 
                    class="search-input" 
                    placeholder="Search users by name"
                    autocomplete="off"
                >
            </div>
        </div>

        <!-- Users Section -->
        <div class="section" id="users-section">
            <h2><i class="fas fa-users"></i> Users</h2>
            <div id="users-content">
                <div class="empty-state" id="users-empty">
                    <i class="fas fa-search empty-state-icon"></i>
                    <h3>Start searching for users</h3>
                    <p>Type in the search box above to find customers</p>
                </div>
                <div class="loading hidden" id="users-loading">
                    <div class="loading-spinner"></div>
                    <p>Searching users...</p>
                </div>
                <ul class="list hidden" id="users-list"></ul>
            </div>
        </div>
    </div>

    <script>
        // DOM elements
        const searchInput = document.getElementById('search');
        
        // Search functionality with debouncing
        let searchTimeout;
        searchInput.addEventListener('input', function() {
            clearTimeout(searchTimeout);
            const query = this.value.trim();
            
            if (query.length < 2) {
                showUsersEmpty();
                return;
            }
            
            searchTimeout = setTimeout(() => {
                searchUsers(query);
            }, 300);
        });

        // Search users function
        async function searchUsers(query) {
            showUsersLoading();
            
            try {
                const response = await fetch(`/api/users?query=${encodeURIComponent(query)}`);
                const users = await response.json();
                
                if (users.length === 0) {
                    showUsersEmpty('No users found matching your search');
                } else {
                    displayUsers(users);
                }
            } catch (error) {
                console.error('Error searching users:', error);
                showUsersEmpty('Error searching users. Please try again.');
            }
        }

        // Display users function
        function displayUsers(users) {
            const usersList = document.getElementById('users-list');
            const usersEmpty = document.getElementById('users-empty');
            const usersLoading = document.getElementById('users-loading');
            
            usersList.innerHTML = '';
            
            users.forEach(user => {
                const li = document.createElement('li');
                li.className = 'list-item user-item';
                li.innerHTML = `
                    <div class="user-info">
                        <div class="user-name">${user.first_name} ${user.last_name}</div>
                        <div class="user-email">${user.email}</div>
                        <div class="user-location">
                            <i class="fas fa-map-marker-alt location-icon"></i>
                            ${user.city}, ${user.state}
                        </div>
                    </div>
                    <div class="user-action">
                        <i class="fas fa-chevron-right"></i>
                    </div>
                `;
                
                // Navigate to user orders page in the same tab
                li.addEventListener('click', () => {
                    window.location.href = `/user/${user.id}/orders`;
                });
                usersList.appendChild(li);
            });
            
            // Show users list
            usersEmpty.classList.add('hidden');
            usersLoading.classList.add('hidden');
            usersList.classList.remove('hidden');
            
            // Animate list items
            const listItems = usersList.querySelectorAll('.list-item');
            listItems.forEach((item, index) => {
                item.style.animationDelay = `${index * 0.1}s`;
                item.classList.add('slide-up');
            });
        }

        // Helper functions for loading states
        function showUsersLoading() {
            document.getElementById('users-empty').classList.add('hidden');
            document.getElementById('users-list').classList.add('hidden');
            document.getElementById('users-loading').classList.remove('hidden');
        }

        function showUsersEmpty(message = 'Start searching for users') {
            const empty = document.getElementById('users-empty');
            empty.querySelector('h3').textContent = message;
            empty.classList.remove('hidden');
            document.getElementById('users-loading').classList.add('hidden');
            document.getElementById('users-list').classList.add('hidden');
        }

        // Focus search input on page load
        window.addEventListener('load', () => {
            searchInput.focus();
        });
    </script>
</body>
</html>
